---
title: "Data summary"
format: 
  html:
    toc: true
    output-file: "index"
editor: visual
---

```{r opts, echo = FALSE, include = FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(here)
library(dplyr)
library(ggplot2)
```

## Commercial landings

```{r, cache=TRUE}
load(here('data/confidential/PacFIN.YTRK.CompFT.09.Oct.2024.RData'))

yt.n.catch <- catch.pacfin |>
  filter(
    AGENCY_CODE == 'W' | AGENCY_CODE == 'O' | COUNTY_NAME == 'DEL NORTE' | COUNTY_NAME == 'HUMBOLDT',
    LANDING_YEAR < 2024
  )

yt.n.catch |>
  group_by(AGENCY_CODE, LANDING_YEAR) |>
  summarise(catch_mt = sum(LANDED_WEIGHT_MTONS)) |>
  ggplot() +
  geom_col(aes(x = LANDING_YEAR, y = catch_mt, fill = AGENCY_CODE)) +
  ggtitle('Commercial landings through 2023')

```

### Washington

```{r}
filter(yt.n.catch, AGENCY_CODE == 'W') |>
  group_by(LANDING_YEAR) |>
  summarise(catch_mt = sum(LANDED_WEIGHT_MTONS)) |>
  knitr::kable(align = 'l', digits = 1)
```

WDFW has alerted the STAT these do not include all tribal catches in recent years. Tribal catches are:

```{r}
filter(yt.n.catch, AGENCY_CODE == 'W', PARTICIPATION_GROUP_NAME == "TREATY INDIAN COMMERCIAL FISHER") |>
  group_by(LANDING_YEAR) |>
  summarise(catch_mt = sum(LANDED_WEIGHT_MTONS)) |>
  knitr::kable(align = 'l', digits = 1)
```

### Oregon

These were provided directly to the STAT

### California

```{r}
filter(yt.n.catch, AGENCY_CODE == 'C') |>
  group_by(LANDING_YEAR) |>
  summarise(catch_mt = sum(LANDED_WEIGHT_MTONS))  |>
  knitr::kable(align = 'l', digits = 1)
```

Note this is for catch landed into Del Norte and Humboldt counties only.

## Recreational landings

### Washington

Modern catches:

```{r}
wa_modern <- readr::read_csv(here('Data/Raw_not_confidential/RecFIN_WA_catch_to_2023.csv')) |>
  filter(RECFIN_WATER_AREA_NAME != 'Canada', RECFIN_YEAR < 2023)
wa_modern |> group_by(RECFIN_YEAR) |>
  summarise(Dead_Catch_mt = sum(SUM_TOTAL_MORTALITY_MT))  |>
  knitr::kable(align = 'l', digits = 1)
```

Questions:

1.  There are three values for `RECFIN_WATER_AREA_NAME`: Estuary, Ocean, and Canada. Which should be included? Above table excludes Canada.
2.  2023 has a number of instances where `RECFIN_WEEK` is zero, and one instance where is it missing. In the instance where it is missing, there is no estimate of catch in mt.

Historical catches:

```{r}
wa_historical <- readr::read_csv(here('Data/Raw_not_confidential/WA_historical_rec.csv'))

wa_historical |>
  group_by(RECFIN_YEAR) |>
  summarise(Dead_Catch_num = sum(RETAINED_NUM)) |>
  knitr::kable(align = 'l', digits = 1)
```

### Oregon

These were provided directly to the STAT

### California

```{r}
ca_modern <- readr::read_csv(here('Data/Raw_not_confidential/RecFIN_CA_catch_to_2023.csv')) |>
  filter(DISTRICT_NAME == "Redwood (Humboldt County, Except Shelter Cover Area, And Del Norte County)" ) 
ca_modern |>
  group_by(RECFIN_YEAR) |>
  summarise(Dead_Catch_mt = sum(SUM_TOTAL_MORTALITY_MT))  |>
  knitr::kable(align = 'l', digits = 1)
  

```

Note that 2020 proxy catches are missing, and we will need historical recreational catches that are not on RecFIN.

## Commercial length data

Initial sample sizes after running `PacFIN.Utilities::cleanPacFIN()`:

```{r, cache=TRUE}
load(here('Data/Confidential/PacFIN.YTRK.bds.09.Oct.2024.RData'))
bds.clean <- PacFIN.Utilities::cleanPacFIN(bds.pacfin, verbose = FALSE) 
bds.clean |>
  filter(state == 'WA' | state == 'OR' | PACFIN_GROUP_PORT_CODE == 'CCA' |
           PACFIN_GROUP_PORT_CODE == 'ERA') |>
  filter(year < 2024) |>
  group_by(state, year) |>
  summarise(n_length = sum(!is.na(length))) |>
  tidyr::pivot_wider(names_from = state, values_from = n_length, values_fill = 0) |>
  arrange(year) |>
  knitr::kable(align = 'l', digits = 1)

```

Note that California lengths are not yet available for 2023.

While running `PacFIN.Utilities::cleanPacFIN()`, it noted that 20 Washington ages in 1991 were double read, the second reader was not recorded, the first and second ages differed, and no final age was determined.
