# Figures

```{r} 
#| label: 'set-rda-dir-figs'
#| echo: false 
#| warning: false 
#| eval: true 
rda_dir <- 'C:/Users/kiva.oken/Desktop/yellowtail_2025/report/rda_files'
``` 

```{r} 
#| label: 'set-fig-uncertainty'
#| echo: false 
#| warning: false 
#| eval: true 
uncertainty <- "recdevs2_withbars.png" %in% dir("r4ss_plots")
```

```{r}
#| label: fig-assessregionmap
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "A map of the west coast of the U.S. depicting the distribution of the northern stock of yellowtail rockfish with a southern boundary at forty degrees and ten minutes and a northern boundary at the Washington state and Canada boundary."

knitr::include_graphics(
    "Figures/assess_region_map_v2.png"
)
```

{{< pagebreak >}}

## Data

```{r}
#| label: fig-data
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "Tabular information for this figure can be found in the data file."

knitr::include_graphics(
    "r4ss_plots/data_plot2.png"
)
```

```{r}
#| label: fig-catch
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Total catch (mt) by fleet (including discards) used in the base model."
#| fig-alt: "See Table TODO for landings by fleet."
#| fig-pos: H

knitr::include_graphics(
    "r4ss_plots/catch2_landings_stacked.png"
)
```

### Indices

```{r}
#| label: fig-orbsqq
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "A q-q plot for the ORBS index depicting the sample quantiles on the y-axis and theoretical quantiles on the x-axis. Data fit the one-to-one line well."

knitr::include_graphics(
    "Figures/ORBSqq.png"
)
```

```{r}
#| label: fig-orbsindex
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "An annual relative index of abundance plotted from 2001 to 2024 with error bars."

knitr::include_graphics(
    "Figures/ORBSIndex.png"
)
```

```{r}
#| label: fig-smurfqq
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "A q-q plot for the SMURF index depicting the sample quantiles on the y-axis and theoretical quantiles on the x-axis. Data fit the one-to-one line well."

knitr::include_graphics(
    "Figures/SMURFqq.png"
)
```

```{r}
#| label: fig-smurfindex
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "An annual relative index of abundance plotted from 2014 to 2024 with error bars."

knitr::include_graphics(
    "Figures/SMURFIndex.png"
)
```

### Composition data

```{r}
#| label: fig-len-agg-fit
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "Aggregated length comps are fit reasonably well."

knitr::include_graphics(
    "r4ss_plots/comp_lenfit__aggregated_across_time.png"
)
```

```{r}
#| label: fig-len-all-bubbles
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "See 'Obs' column in CompReport.sso for values."

knitr::include_graphics(
    "r4ss_plots/comp_lendat__multi-fleet_comparison.png"
)
```

```{r}
#| label: fig-len-all-pearson
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "See 'Pearson' column in CompReport.sso for values."

knitr::include_graphics(
    "r4ss_plots/comp_lenfit__multi-fleet_comparison.png"
)
```

```{r}
#| label: fig-age-agg-fit
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "Aggregated age comps are fit reasonably well."

knitr::include_graphics(
    "r4ss_plots/comp_agefit__aggregated_across_time.png"
)
```

```{r}
#| label: fig-age-all-bubbles
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "See 'Obs' column in CompReport.sso for values."

knitr::include_graphics(
    "r4ss_plots/comp_agedat__multi-fleet_comparison.png"
)
```

```{r}
#| label: fig-age-all-pearson
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "See 'Pearson' column in CompReport.sso for values."

knitr::include_graphics(
    "r4ss_plots/comp_agefit__multi-fleet_comparison.png"
)
```

```{r}
#| label: fig-param-dist
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "TODO"

knitr::include_graphics(
    "Figures/parameter_distributions.png"
)
```

TODO: add mean length and age plots?

TODO: add CAAL plots?

{{< pagebreak >}}

## Model Bridging

## Biology

```{r}
#| label: fig-growth1
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "Growth curves for females and males diverge are similar up to about age 8 after which females are notably larger. For both sexes the growth asymptotes around age 20. See parameter table for growth parameters."

knitr::include_graphics(
    "r4ss_plots/bio1_sizeatage.png"
)
```

```{r}
#| label: fig-growth2
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "See biology at age and biology at length tables in Report.sso for information on the relationship between growth maturity and weight."

knitr::include_graphics(
    "r4ss_plots/bio3_sizeatage_plus_WT_and_MAT.png"
)
```

## Selectivity

```{r}
#| label: fig-sel-length
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "See the LEN_SELEX table (with Factor = 'Lsel') in Report.sso file for values."

knitr::include_graphics(
    "r4ss_plots/sel01_multiple_fleets_length1.png"
)
```

```{r}
#| label: fig-sel-age
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "See the AGE_SELEX table (with Factor = 'Asel2') in Report.sso file for values."

knitr::include_graphics(
    "r4ss_plots/sel02_multiple_fleets_age2.png"
)
```

```{r}
#| label: fig-sel-tv
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "See the AGE_SELEX table (with Factor = 'Lsel') in Report.sso file for values."

knitr::include_graphics(
    "Figures/selectivity_time-varying.png"
)
```

## Fits to Data

## Time-series

```{r} 
#| label: fig-sb
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Estimated time series of spawning output for the base model."
#| fig-alt: ""
#| fig-pos: H

if (uncertainty) {
    knitr::include_graphics(
        "r4ss_plots/ts7_Spawning_output_with_95_intervals.png"
    )
} else {
    knitr::include_graphics(
        "r4ss_plots/ts7_Spawning_output.png"
    )
}
```

```{r} 
#| label: fig-depl
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Estimated time series of fraction of unfished spawning output for the base model."
#| fig-alt: "See table TODO"
#| fig-pos: H

if (uncertainty) {
    knitr::include_graphics(
        "r4ss_plots/ts9_Relative_spawning_output_intervals.png"
    )
} else {
    knitr::include_graphics(
        "r4ss_plots/ts9_Relative_spawning_output.png"
    )
}
```

```{r} 
#| label: fig-recruits
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Estimated time series of age-0 recruits for the base model."
#| fig-alt: ""
#| fig-pos: H

if (uncertainty) {
    knitr::include_graphics(
        "r4ss_plots/ts11_Age-0_recruits_(1000s)_with_95_asymptotic_intervals.png"
    )
} else {
    knitr::include_graphics(
        "r4ss_plots/ts11_Age-0_recruits_(1000s).png"
    )
}
```

\pagebreak

```{r} 
#| label: fig-recdevs
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Estimated time series of recruitment deviations for the base model."
#| fig-alt: ""
#| fig-pos: H

if (uncertainty) {
    knitr::include_graphics(
        "r4ss_plots/recdevs2_withbars.png"
    )
} else {
    knitr::include_graphics(
        "r4ss_plots/recdevs1_points.png"
    )
}

```

```{r} 
#| label: fig-spr
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Estimated time series of fishing intensity for the base model."
#| fig-alt: ""
#| fig-pos: H

if (uncertainty) {
    knitr::include_graphics(
        "r4ss_plots/SPR3_ratiointerval.png"
    )
} else {
    knitr::include_graphics(
        "r4ss_plots/SPR1_series.png"
    )
}
```

```{r} 
#| label: fig-spr-phase
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Phase plot of fishing intensity versus fraction unfished for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  "r4ss_plots/SPR4_phase.png"
)

```

```{r} 
#| label: fig-yield
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated yield curve with reference points for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  "r4ss_plots/yield2_yield_curve_with_refpoints.png"
)

```

```{r} 
#| label: fig-dyn-b0
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Dynamic B0 plot. The lower line shows the time series of estimated spawning output in the presence of fishing mortality. The upper line shows the time series that could occur under the same dynamics (including deviations in recruitment), but without fishing. The point at the left represents the unfished equilibrium."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  "r4ss_plots/ts_DynamicB0.png"
)

```

## Sensitivity analyses

## Retrospectives and likelihood profiles

```{r}
#| label: fig-historical
#| echo: false
#| warning: false
#| eval: true
#| fig-alt: "A time series of 13 colored lines showing estimates from 9 different assessments. The majority of the lines had similar scale and declined at a similar rate in the 1970s and 80s, but whereas the assessments conducted between 1991 and 2005 show one-way trips, those conducted in 2013 and onward show increases starting between 1990 and 2000. The current base model shows a lower scale than the previous assessment."

knitr::include_graphics(
    "Figures/historical_assessment_timeseries.png"
)
```

```{r}
#| label: fig-retro1
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Retrospective results: change in the estimate of spawning output when the most recent 5 years of data area removed sequentially."
#| fig-alt: "Time series is similar for all models."
#| fig-pos: H

knitr::include_graphics(
    "diagnostics/compare1_spawnbio.png"
)
```

```{r}
#| label: fig-r0-profile
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Change in the negative log-likelihood across a range of log(R0) values."
#| fig-alt: "U-shaped profiles show consistent support for similar log-R0 values with some minor differences among data types and fleets."
#| fig-pos: H

knitr::include_graphics(
  "diagnostics/piner_panel_SR_LN(R0).png"
)
```

```{r}
#| label: fig-r0-profile-pars
#| echo: false
#| warning: false
#| eval: true
#| #| fig-cap: "Change in quantities of interest related to spawning output across a range of log(R0) values: fraction of unfished spawning output in 2025 (top-right), spawning output in 2025 (bottom-right), and unfished equilibrium spawning output (bottom-left). These are shown along with the change in total negative log-likelihood (top-left, matches previous figure)."
#| fig-alt: "The spawning output at initial remains more stable over the range of log-R0 values than the final spawning output so at low log-R0 the stock is estimated to be at a small fraction of unfished. However, the change in likelihood at those values is large, indicating that the low log-R0 values are not supported by the data."
#| fig-pos: H

knitr::include_graphics(
    "diagnostics/parameter_panel_SR_LN(R0).png"
)
```

```{r}
#| label: fig-m-profile
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Change in the negative log-likelihood across a range of female natural mortality (M) values"
#| fig-alt: "U-shaped profiles show some differences among data types and fleets over M values explored with the age and length data supporting a higher M while the indices and recruitment penalties support a lower M."
#| fig-pos: H

knitr::include_graphics(
    "diagnostics/piner_panel_NatM_uniform_Fem_GP_1.png"
)
```

```{r}
#| label: fig-m-profile-pars
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Change in quantities of interest related to spawning output across a range of female natural mortality (M) values: fraction of unfished spawning output in 2025 (top-right), spawning output in 2025 (bottom-right), and unfished equilibrium spawning output (bottom-left). These are shown along with the change in total negative log-likelihood (top-left, matches previous figure)."
#| fig-alt: "At low M values, the final spawning output decreases while the initial remains stable, leading to a smaller fraction of unfished. However, the change in likelihood at those values is large, indicating that low M is not supported by the data."
#| fig-pos: H

knitr::include_graphics(
    "diagnostics/parameter_panel_NatM_uniform_Fem_GP_1.png"
)
```

```{r}
#| label: fig-h-profile
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Change in the negative log-likelihood across a range of steepness (h) values"
#| fig-alt: "All data sources with the exception of the commercial length comps support a high steepness value (close to 1.0)."
#| fig-pos: H

knitr::include_graphics(
    "diagnostics/piner_panel_SR_BH_steep.png"
)
```

```{r}
#| label: fig-h-profile-pars
#| echo: false
#| warning: false
#| eval: true
#| fig-cap: "Change in quantities of interest related to spawning output across a range of steepness (h) values: fraction of unfished spawning output in 2025 (top-right), spawning output in 2025 (bottom-right), and unfished equilibrium spawning output (bottom-left). These are shown along with the change in total negative log-likelihood (top-left, matches previous figure)."
#| fig-alt: "At low steepness values, the initial spawning output increases and the final spawning output decreases, leading to a smaller fraction of unfished. However, the change in likelihood at those values is large, indicating that low steepness is not supported by the data."
#| fig-pos: H

knitr::include_graphics(
    "diagnostics/parameter_panel_SR_BH_steep.png"
)
```
